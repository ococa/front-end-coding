计算机网络 笔记
## 什么是计算机网络 => 特殊的通信网络

- 计算机网络是互联的，自治的计算机集合（自治-> 无主从关系， 自治-> 互联互通）
    - 计算机技术 + 通信技术（通信系统在计算机领域的使用）
    - 通信网络： 信源 -> 发送设备 -> 信道（噪声源） ->  接受设备 ->  信宿
    - 距离远的互联互通
- 计算机网络实现：主机 -> 交换节点（路由器或交换机）-> 交换节点 -> 主机
    - 交换节点组成交换网络
1. 什么是internet
	- 全球最大的互联网络
		- ISP（internet service provider）网络互联的 ”网络之网络“

## 计算机网络的实现
1. 硬件 =》 路由器/交换机

2. 软件 =》 网络协议（network protocol）
	- 1. what: 为了进行网络中数据交换而建立的规则标准和协议
	- 2. how: 规定了通信实体之间所交换的消息的格式，意义，顺序，以及针对收到信息或者发生时间所采取的"动作"（actions）
	- 3. other: 三要素： 
		- 1. 语法（syntax）
		- 2. 语义（semantics）
		- 3. 时序（timing）

## 计算机网络的结构

1. 网络边缘
	- 1. 主机
	- 2. 网络应用
		- 模型：
			- 1. 客户/服务器应用模型 (client（发起请求）/server（响应请求）)
			- 2. 对等应用模型（peer-peer, p2p） 无专用服务器

2. 接入网络， 物理介质
	- 有限或无线通信链路
	- what： 将网络边缘接入到核心网络
	- 分类： 1. 家庭，2. 机构，3.移动接入网络
	- 关注点： 1. 带宽（bandwidth， bps） 2. 独占还是共享
	- how： 
		1. 数组用户线路（利用电话线接入24M独占）： dsl(调制解调器/modem) -> dslam -> isp
		2. 电缆网络（利用有线电视网络, 频分多路复用 30M共享）
		3. 

3. 网络核心（核心网络）
	- what：路由（routing）+ 转发（forwarding）
	- 如何实现数据从源主机到目标主机：数据交换
	- 互联的路由器（或分组转发设备）

## isp

1. 端 通过接入isp（acces isp）连接到internet

2. isp之间需要能够相互通讯 实现网络互联
方案1： 彼此互联，缺点：O（n²）的连接量 不适用于大规模网络。
方案2： 维护一个或多个global isp（国家或者全球级别）处理边缘access isp， global isp相互连接（通过ixp或者 p2p）


## 数据传输

### 多路复用
fdm 频分复用
cdm 码分复用
tdm 时分复用

### 数据交换
1. 分组交换 （互联网方式）（效率高，节点之间并行传输。节点要求低，每次缓存一个数据包的数据即可）
	- 可能产生拥塞（congestion），分组延迟和丢失
		- 需要协议处理可靠数据传输和拥塞控制
		- 发生延迟的原因： 当到达一个传输节点的时候，有正在传输的包 需要等待
		- 发生丢包的原因：当到达一个传输节点的时候，当前节点可用缓存用完则丢包（loss）
2. 报文交换（整体传输 效率低 成本高）
3. 电路交换（传统电话通信方式）
	- 性能可靠

## 计算机网络的性能
指标：
1. 速率-》 比特率 -》 bit rate -》 b/s , bps, kb/s, Mb/s ...
2. 带宽
3. delay 延迟
	- 分组延迟类型：
	1. 节点处理延迟 d（proc） node processing delay
		1. 插座检测
		2. 确定输出链路
		d通常 < msec(毫秒)
	2. 排队延迟 d（queue） queue delay
		1. 等待输出链路可用
		d =》 取决于路由器拥塞程度
	3. 传输延迟 d（trans） transmission delay
		d = L（分组长度）/R（链路带宽）
	4. 传播延迟 d（prop）propagation delay
		d取决于 物理链路长度/信号传播速度
4. 时延带宽积 = 传播时延d（prop） * 带宽
5. 丢包率
6. 吞吐率
	即时吞吐量
	平均吞吐量

## 分层
### osi参考模型
1. 物理层功能（传输帧）
	1. 接口特性
	2. 比特编码
	3. 数据率
	4. 比特同步（时钟同步）
	5. 传输模式
		- 单工
		- 半双工
		- 全双工
2. 数据链路层（组帧）
	负责结点到结点的传输
	组帧
	物理寻址
		在帧头增加发送端和/或接受端的物理地址，标识数据帧的发送端和/或接收端
	浏览控制
		避免淹没接收端
	差错控制
	访问控制

3. 网络层
	负责源主机到目的主机数据分组的交互
		- 穿越多个网络
	逻辑寻址（logical addressing）
		- 全局唯一的逻辑地址，确保数据分组被送达目的主机，如ip地址
	路由（routing）
		路由器或网关互联网络，并路由分组至最终目的主机
		路径选择
	分组转发
4. 传输层（段 segments）
	负责 源-目的（端-端） （进程间）完整报文传输
	报文的分段和重组
	sap寻址（确保完整报文提交给正确进程，如端口号）
	连接控制（逻辑连接）
	流量控制
	差错控制
5. 会话层（最薄的一层。 目前internet实际的网络中不单独存在）
	对话控制，建立控制
	同步
		- 在数据流中插入同步点（用于出现意外之后恢复标记）

6. 表示层(处理两个系统之间交换信息的语法语义问题。 目前internet中不单独纯在，应用层承担这些功能)
	数据表示转换
		- 转换为主机独立编码
	加密/解密
	压缩/解压
7. 应用层（最丰富的一层）
	支持用户通过用户代理（如浏览器）或网络接口使用网络（服务）
	典型的应用层服务
		- 文件传输ftp
		- 电子邮件smtp
		- web （http）

### tcp/ip参考模型(everything over ip)
1. 网络接口层
2. 网际层
	- ip
3. 传输层
	- tcp 
	4. 应用层
		- http
		- smtp
	- udp
	4. 应用层
		- dns
		- rtp

### 五层参考模型（综合了tcp/ip和osi）现在网络中应用和实践的模型
1. 物理层 （比特 bit）
2. 数据链路层（帧 iframe）
3. 网络层 （数据报 dategram）
4. 传输层（段 segments）
5. 应用层（报文 message）

## 计算机网络的发展历史

## 应用层

### 网络应用体系结构
1. c-s
2. p2p
3. 混合(hybrid)

### 网络应用的基础
进程
	1. 同一主机上的进程通信
		- 进程间通信机制
		- 操作系统提供
	2. 不同主机上运行的进程间如何通信
		- 消息交换
		客户机进程 发起通信的进程
		服务器进程 等待通信请求的进程
		- 不同主机进程通信，如何寻址进程
			1. 每个进程必须拥有标识符（标识符 = ip地址 + 端口号）
			2. 如何寻址主机 -》 ip地址
			3. 进程寻址-》 端口号寻址 （为每一个需要通信的进程分配一个端口号（port））

	套接字 socket（操作系统提供的用于网络编程的api）
		- 进程通过套接字的抽象来使用下层协议栈（tcp）

### 网络应用的服务需求
1. 可靠性
2. 时延
3. 带宽

### internet传输层服务模型
1. tcp
	- 面向连接
	- 可靠传输
	- 流量控制
	- 拥塞控制
	- 不提供最小带宽保障
	- 不提供时间/延迟保障

2. udp
	- 无连接
	- 不可靠数据传输

### 网络应用和协议（web应用）

#### 应用层协议
1. http(无状态协议)
	- http1.0  非持久性连接，每个tcp连接最多允许一个对象
		- 每个引用对象消耗两个rtt，一次tcp连接 = 2 * rtt
	- http1.1  持久性连接，每个tcp连接允许传输多个对象
		- 无流水pipelining的持久性连接
			- 每个引用的对象消耗一个rtt
		- 带有流水机制的持久性连接
			- 客户端只要遇到一个引用对象就尽快发出请求
			- 理想情况 所有的对象只需要消耗一个rtt

2. smtp, pop, imap
3. dns
4. p2p

#### web应用
web应用 -> 基于http 协议 -> tcp协议
1. www 万维网
2. 对象寻址 URL 统一资源定位器


##### **响应时间的分析和建模**

###### 1. RTT（round trip time）
- 从客户端发送一个很小的数据报到服务器并返回所经历的时间

###### 2. 响应时间（response time）
1. 发起，建立tcp连接： 1个rtt
2. 发送http请求消息到http响应消息的前几个字节到达： 1个rtt
3. 响应消息中所含的文件/对象传输时间

总时间 total = 2rtt + 文件发送的时间

#### http消息格式（请求-响应）
##### 请求消息 ascii码编写
1. request line 请求行
2. header lines 请求头部/首部 （为什么已经建立连接还要在头部申明 host：www.baidu.com）
3. 空行 = 回车 + 换行
4. body

##### 响应消息
1. status line 状态行 = （protocol status code status phrase）
2. header lines 头部
3. 空行
4. body

#### cookie（RFC6265）

简介：http是无状态的。通过cookie实现用户状态记录
实现：
    1. request header ：cookie 
    2. response header ： set-cookie
    3. 保存在客户端主机上的cookie文件，由浏览器进行管理
    4. web服务器端后台数据库
作用：
    身份标记，有状态
    身份识别
缺点：
    隐私问题
    
    
    
#### web缓存（web代理服务器技术）
功能： 在不访问服务器的前提下满足客户端的http请求
why：
    - 缩短请求响应时间
    - 减少服务器流量开销
    - 在大范围内实现有效内容分发（cdn）
who：
    web缓存/代理服务器
    - 用户通过浏览器访问服务器a
    - 浏览器想缓存/代理服务器发送所有http请求
        - 如果所请求的帝乡在缓存中，缓存返回对象
        - 否则，缓存服务器像原始服务器发送http请求，获取对象，然后返回给客户端并保存该对象
    缓存服务器既充当客户端又充当服务器
    一般由ISP（internet服务提供商 电信 移动）架设
how：
    - 协商缓存 条件性get方法
        - 1. last-modified
            client: 1. request header：if-modified-since: <date>
            server: 2. response header: http/1.0 304 not modified
        - 2. eTag   
    - 强缓存 
        - 
        -        
        
        
#### email应用

##### 邮件传输协议（命令-响应）
协议 SMTP协议（RFC2821）
1. 持久性连接
2. 7位ascii码
3. SMTP服务器利用 CRLF.CRLF确定消息结束

与http对比
- http： pull
- SMTP： push

MIME: 多媒体邮件扩展 RFC2045， 2056 

##### 邮件访问协议
1. POP协议 （RFC 1939） Post Office Protocol
    POP3 是无状态协议
    - 认证/授权（客户端 《--》 服务器）和下载
    实现：
        1. 认证过程（登录 -》 验证）
        2. 事务阶段（删 查（list， detail） 退出）
    
2. IMAP协议：Internet Mail Access Protocol（RFC1730）
    1. 消息保存在服务器
    2. 允许用户利用文件夹组织消息
    2. 支持跨会话的用户状态
3. HTTP协议：qq mail，163.

#### dns概述 domain name system（查询-回复）

用来干嘛：解决互联网上主机和路由器的识别问题（域名 -> ip地址）

是什么：域名解析系统
    - 多层命名服务器构成的分布式数据库
    - 应用层协议：完成名字的解析
        - internet核心功能
        - 网络边界复杂
做什么：
    1. 域名向ip解析
    2. 直接别名
    3. 邮件服务器别名
    4. 负载均衡：web服务器

怎么查：
查询 www.amazon.com
   迭代查询，被查询服务器返回解析域名服务器
1. 查询根服务器找到 com dns servers 地址
2. 查询com dns，找到amazon.com dns servers域名解析器，返回amazon.com dns地址
3. 查询amazon.com 域名解析服务器，获得www.amazon.com的ip地址

other: 
    - **本地域名解析服务器**无法解析域名时，去查询根域名服务器
    - 根域名服务器如果不知道映射是什么，会（1. 查询权威域名服务器 2. 获得映射 3. 向本地域名服务器返回映射）
    - 根域名服务器有13个，中国没有
    - 顶级级域名服务器（com， edu， org， 以及国家顶级域名）
    - 权威域名服务器（服务商或者组织）
 
本地域名解析服务器（每一个isp都有一个本地域名服务器（又叫默认域名服务器）） -> 系统设置里面的dns服务器
    1. 不属于层级体系
    - 当主机进行dns查询是，查询先发到本地域名服务器
    - 本地域名服务器作为proxy，将查询转发给层级域名解析服务器

dns缓存：
1. 只要域名解析服务器获得域名-ip映射，即缓存这一映射
    - 一段时间过后缓存条目失效（删除）
    - 本地域名服务器一般会缓存顶级域名服务器映射（根域名服务器不经常被访问）
    - 记录的更新通知机制 RFC（2136）
    
    
dns记录和消息格式：
名称： 资源记录（resource records）
格式：（name， value，type，ttl） 
    - ttl 时间有效性
    - type = A;  name：主机域名，value 是 ip地址
    - type = NS; name: 域（edu.cn）， value是该域名的权威域名解析服务器的主机域名
    - type = CNAME； name是域名别名，value是真实域名
    - type = MX； 邮件域名服务，value指与name对应的邮件服务器
    
```
                                                 Root DNS server 
               
        com DNS servers                         org DNS servers             edu dns servers

(yahoo.com & amazon.com & ...) dns servers      pbs.org dns servers      (poly.edu & umass.edu & ...) dns       
```

### socket编程
tcp
udp


































